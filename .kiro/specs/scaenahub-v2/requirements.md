# ScaenaHub v2 要件書

## 概要

ScaenaHub v2は、既存のScaenaHubを基盤として、データベースをTiDB Cloud Serverlessに移行し、Discord風の高度なコミュニケーション機能を追加したWebアプリケーションです。iPad・PC・スマホ対応のレスポンシブデザインで、チーム内コミュニケーションを効率化します。

## 要件

### 要件 1

**ユーザーストーリー:** ユーザーとして、安全にアカウントを作成・管理したい、セキュアな環境でサービスを利用するため

#### 受入基準

1. WHEN ユーザーがアカウント登録を行う THEN システムは ユーザー名、パスワード、ユーザー登録キーの入力を要求する SHALL
2. WHEN ユーザー登録キーが正しくない THEN システムは 登録を拒否し、エラーメッセージを表示する SHALL
3. WHEN ユーザーがログインする THEN システムは ユーザー名とパスワードで認証を行う SHALL
4. WHEN ユーザーがアカウント情報を編集する THEN システムは ユーザー名、メールアドレス、パスワードの変更を許可する SHALL

### 要件 2

**ユーザーストーリー:** ユーザーとして、プロフィールを設定・表示したい、他のユーザーとの交流を深めるため

#### 受入基準

1. WHEN ユーザーがプロフィールを設定する THEN システムは アバター画像と自己紹介文の設定を許可する SHALL
2. WHEN ユーザーがオンラインステータスを変更する THEN システムは オンライン、退席中、取り込み中、オフラインの状態を表示する SHALL
3. WHEN ユーザーがカスタムステータスを設定する THEN システムは 任意のテキストや絵文字での状況表示を許可する SHALL
4. WHEN 他のユーザーがプロフィールを閲覧する THEN システムは アバター、ステータス、自己紹介、ロール情報を表示する SHALL

### 要件 3

**ユーザーストーリー:** 管理者として、サーバーとメンバーを管理したい、適切な運営を行うため

#### 受入基準

1. WHEN 管理者がサーバー設定を変更する THEN システムは サーバー名の変更を許可する SHALL
2. WHEN 管理者がメンバー管理を行う THEN システムは メンバー一覧表示、ロール確認・付与、キック、BAN操作を提供する SHALL
3. WHEN 管理者が自動モデレーション設定を行う THEN システムは 設定ルールに基づく不適切投稿の自動ブロック・警告機能を提供する SHALL
4. WHEN 管理者がWeb管理ダッシュボードにアクセスする THEN システムは 全ての管理機能をWeb上で操作可能にする SHALL

### 要件 4

**ユーザーストーリー:** ユーザーとして、多様なチャンネルでコミュニケーションを取りたい、目的に応じた情報共有を行うため

#### 受入基準

1. WHEN ユーザーがテキストチャンネルを利用する THEN システムは テキストメッセージ、画像、ファイルの送受信機能を提供する SHALL
2. WHEN 管理者がアナウンスチャンネルを作成する THEN システムは 上層部から全員・多数への一方向アナウンス機能を提供する SHALL
3. WHEN ユーザーがディスカッションチャンネルを利用する THEN システムは 問題ごとのスレッド作成・管理・解決時の閉鎖機能を提供する SHALL
4. WHEN 管理者がチャンネルを管理する THEN システムは チャンネル作成・削除、カテゴリー管理、権限設定機能を提供する SHALL

### 要件 5

**ユーザーストーリー:** 管理者として、ロールと権限を細かく制御したい、適切なアクセス管理を行うため

#### 受入基準

1. WHEN 管理者がロールを作成・編集する THEN システムは ロール名、色、権限の設定を許可する SHALL
2. WHEN 管理者がユーザーに複数ロールを付与する THEN システムは 各権限で最も強い権限を優先適用する SHALL
3. WHEN 管理者がロール階層を設定する THEN システムは 上位ロールが下位ロールを管理できる仕組みを提供する SHALL
4. WHEN 管理者がチャンネル権限を設定する THEN システムは ロール・メンバー単位での閲覧・書き込み権限制御を提供する SHALL

### 要件 6

**ユーザーストーリー:** ユーザーとして、リッチなメッセージング機能を利用したい、効果的なコミュニケーションを行うため

#### 受入基準

1. WHEN ユーザーがメッセージを送信する THEN システムは リアルタイムでの送受信を提供する SHALL
2. WHEN ユーザーがメッセージを編集・削除する THEN システムは 自分のメッセージの編集・削除と履歴保持を許可する SHALL
3. WHEN ユーザーがメンションを使用する THEN システムは @ユーザー名、@ロール名での通知機能を提供する SHALL
4. WHEN ユーザーがMarkdown記法を使用する THEN システムは 太字、斜体、打ち消し線等の書式設定を提供する SHALL

### 要件 7

**ユーザーストーリー:** ユーザーとして、ファイルやメディアを共有したい、豊かなコンテンツ交流を行うため

#### 受入基準

1. WHEN ユーザーがファイルをアップロードする THEN システムは Google Driveへの保存とチャットでの共有を提供する SHALL
2. WHEN ユーザーがリアクションを追加する THEN システムは 絵文字・GIF・スタンプでの反応機能を提供する SHALL
3. WHEN ユーザーがURLを投稿する THEN システムは リンクプレビューの自動表示を提供する SHALL
4. WHEN ユーザーがメディアファイルを共有する THEN システムは 画像・動画のプレビュー表示を提供する SHALL

### 要件 8

**ユーザーストーリー:** ユーザーとして、高度なメッセージ機能を利用したい、整理された情報交換を行うため

#### 受入基準

1. WHEN ユーザーがスレッドを作成する THEN システムは 特定メッセージからの派生会話をスレッド形式で管理する SHALL
2. WHEN ユーザーがメッセージを検索する THEN システムは キーワードでの過去メッセージ検索機能を提供する SHALL
3. WHEN ユーザーがメッセージをピン留めする THEN システムは 重要メッセージのチャンネル上部固定表示を提供する SHALL
4. WHEN ユーザーがメッセージ履歴を閲覧する THEN システムは 無限スクロールでの履歴表示を提供する SHALL

### 要件 9

**ユーザーストーリー:** システムとして、TiDB Cloud Serverlessを効率的に利用したい、コスト効率と性能を両立するため

#### 受入基準

1. WHEN バックエンドサーバーが起動する THEN システムは TiDBから必要データをローカルDBファイルに読み込む SHALL
2. WHEN データ読み込みが発生する THEN システムは 主にローカルDBファイルから読み込みを行う SHALL
3. WHEN データ書き込みが発生する THEN システムは ローカルDBファイルとTiDBの両方に同期書き込みを行う SHALL
4. WHEN ローカルDBの容量が制限に近づく THEN システムは 古いデータをTiDBのみに保持し、ローカルから削除する SHALL

### 要件 10

**ユーザーストーリー:** システムとして、セキュアな環境変数管理を行いたい、データ漏洩を防ぐため

#### 受入基準

1. WHEN システムが初回起動する THEN システムは .envファイルから設定を読み込む SHALL
2. WHEN システムが稼働中である THEN システムは .envファイルへの読み書きを行わない SHALL
3. WHEN 秘密鍵が必要な処理を行う THEN システムは メモリ上の値のみを使用する SHALL
4. WHEN システムがログ出力を行う THEN システムは 秘密鍵情報をログに出力しない SHALL

### 要件 11

**ユーザーストーリー:** ユーザーとして、レスポンシブなUIを利用したい、iPad・PC・スマホで快適に操作するため

#### 受入基準

1. WHEN ユーザーがiPadでアクセスする THEN システムは タッチ操作に最適化されたUIを提供する SHALL
2. WHEN ユーザーがPCでアクセスする THEN システムは マウス・キーボード操作に最適化されたUIを提供する SHALL
3. WHEN ユーザーがスマホでアクセスする THEN システムは モバイル画面サイズに最適化されたUIを提供する SHALL
4. WHEN 画面サイズが変更される THEN システムは 自動的にレイアウトを調整する SHALL

### 要件 12

**ユーザーストーリー:** システムとして、MySQL互換のTiDBで動作したい、データベース移行を成功させるため

#### 受入基準

1. WHEN システムがTiDBに接続する THEN システムは MySQL互換のクエリを使用する SHALL
2. WHEN データベーススキーマを作成する THEN システムは TiDBでサポートされる機能のみを使用する SHALL
3. WHEN データ型を定義する THEN システムは MySQL互換のデータ型を使用する SHALL
4. WHEN インデックスを作成する THEN システムは TiDBで最適化されたインデックス設計を使用する SHALL

### 要件 13

**ユーザーストーリー:** システムとして、Render.comの制約内で動作したい、無料枠での安定運用を実現するため

#### 受入基準

1. WHEN システムがRender.comにデプロイされる THEN システムは 512MBのRAM制限内で動作する SHALL
2. WHEN データ永続化が必要な場合 THEN システムは TiDBまたはGoogle Driveを使用する SHALL
3. WHEN システムが再起動される THEN システムは ローカルファイルの消失に対応できる SHALL
4. WHEN 月間Request Unitが上限に近づく THEN システムは 管理者に警告を表示する SHALL

### 要件 14

**ユーザーストーリー:** ユーザーとして、脚本を閲覧・編集したい、演劇制作において脚本を効率的に管理・共有するため

#### 受入基準

1. WHEN ユーザーが脚本ビューにアクセスする THEN システムは 登場人物名、台詞（動き等）、照明、音響と映像、備考の5列構成で脚本を表示する SHALL
2. WHEN ユーザーが脚本を閲覧する THEN システムは 台詞を黒字、動きを青字で区別して表示する SHALL
3. WHEN ユーザーが脚本を編集する THEN システムは 各セルの内容を直接編集可能にする SHALL
4. WHEN ユーザーが書式設定を行う THEN システムは 太字、下線、斜体の簡単な書式設定機能を提供する SHALL
5. WHEN ユーザーが脚本を保存する THEN システムは 変更内容をリアルタイムでデータベースに保存する SHALL
6. WHEN 複数ユーザーが同時編集する THEN システムは 競合を防ぐためのロック機能または変更通知機能を提供する SHALL
7. WHEN ユーザーが脚本の行を追加・削除する THEN システムは 行の挿入・削除機能を提供する SHALL
8. WHEN 管理者が脚本の編集権限を設定する THEN システムは ロール・ユーザー単位での編集権限制御を提供する SHALL

### 要件 15

**ユーザーストーリー:** システムとして、完全無料で長期間安定稼働したい、予算制約なしでサービスを提供するため

#### 受入基準

1. WHEN システムが運用される THEN システムは 全てのサービスの無料枠内で動作する SHALL
2. WHEN TiDB Cloud Serverlessを使用する THEN システムは 5GiB容量、月間5000万Request Unitの制限内で動作する SHALL
3. WHEN Google Driveを使用する THEN システムは 無料の15GB容量制限内でファイル保存を行う SHALL
4. WHEN Render.comを使用する THEN システムは 無料プランの制約（512MB RAM、データ非永続化）内で動作する SHALL
5. IF いずれかのサービスで使用量が上限に近づく THEN システムは 管理者に事前警告を表示する SHALL