# ScaenaHub v2 実装タスクリスト

## 実装計画

以下のタスクは、テスト駆動開発を基本とし、段階的に機能を構築していきます。各タスクは前のタスクの成果物を基盤として進めます。

- [x] 1. プロジェクト基盤とTiDB接続の構築



  - Node.js 22/Express.js プロジェクトの初期化とTypeScript設定
  - TiDB Cloud Serverless接続設定とMySQL互換クエリの実装
  - 環境変数管理と秘密鍵の安全な取り扱い設定
  - 基本的なフォルダ構造とlinting設定を作成
  - _要件: 9.1, 9.2, 10.1, 10.2, 12.1, 12.2, 12.3_




- [x] 2. データベーススキーマとローカルキャッシュの実装

  - TiDBデータベーススキーマ（users, roles, channels, messages等）をMySQL互換で作成
  - SQLiteローカルキャッシュデータベースの設定と初期化
  - TypeScriptでのデータモデル定義とバリデーション関数を実装
  - データ同期サービス（TiDB ↔ SQLite）の基本実装
  - _要件: 9.1, 9.2, 9.3, 12.1, 12.2, 12.3_

- [x] 3. 認証システムとユーザー管理の実装





  - JWT認証サービス（ログイン、登録、トークン検証）を実装
  - 登録キー検証機能付きユーザー登録APIを作成
  - 認証ミドルウェアとセッション管理を実装
  - ユーザープロフィール管理（基本情報、アバター）APIを実装
  - 認証関連のユニットテストを作成
  - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2_

- [x] 4. 拡張ユーザープロフィール機能の実装



  - オンラインステータス管理（online, away, busy, offline）を実装
  - カスタムステータス機能（テキスト、絵文字、有効期限）を実装
  - 自己紹介文とプロフィール表示機能を実装
  - ユーザープロフィール表示コンポーネントを作成
  - プロフィール機能のテストを作成
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 5. 階層的ロール・権限管理システムの実装



  - 複数ロール対応のロール管理APIを実装
  - 階層的権限システム（上位ロールが下位ロールを管理）を実装
  - 権限チェック機能とミドルウェア（最強権限優先）を作成
  - ロール作成・編集・削除・色設定機能を実装
  - ロール・権限管理のテストを作成
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [x] 6. 多様なチャンネル管理システムの実装



  - テキスト、アナウンス、ディスカッションチャンネルの作成・管理APIを実装
  - カテゴリー管理機能（チャンネルのグループ化）を実装
  - チャンネル権限設定機能（ロール・ユーザー単位のアクセス制御）を実装
  - プライベートチャンネル機能を実装
  - チャンネル管理のテストを作成
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 7. 高度なメッセージシステムの実装





  - メッセージ投稿・編集・削除APIを実装（管理者はすべてのメッセージへの読み書き権限を持つようにする）
  - メンション機能（@ユーザー名、@ロール名）を実装
  - Markdown記法サポート（太字、斜体、打ち消し線等）を実装
  - メッセージ履歴取得とページネーション機能を実装
  - メッセージ関連のテストを作成
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 8. リッチコンテンツとリアクション機能の実装



  - メッセージリアクション追加・削除機能（絵文字・GIF・スタンプ）を実装
  - リンクプレビュー自動生成機能を実装
  - 画像・動画プレビュー表示機能を実装
  - ファイル・メディア共有機能をGoogle Drive連携で実装
  - リッチコンテンツ機能のテストを作成
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 9. スレッドとメッセージ検索機能の実装



  - スレッド作成・返信機能を実装
  - メッセージ検索機能（キーワード、日付、ユーザー絞り込み）を実装（検索時はTiDBに接続）
  - メッセージピン留め機能を実装
  - 無限スクロールでのメッセージ履歴表示を実装
  - スレッド・検索機能のテストを作成
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 10. Socket.ioリアルタイム通信とプレゼンス機能の実装



  - Socket.ioサーバー設定とイベントハンドラーを実装
  - リアルタイムメッセージ配信機能を実装
  - オンラインステータス・プレゼンス管理機能を実装
  - メンション通知とリアクション同期機能を実装
  - WebSocket認証とエラーハンドリングを実装
  - _要件: 6.1, 6.2, 2.2, 2.3_

- [x] 11. 自動モデレーション機能の実装





  - 不適切投稿の自動検出・ブロック機能を実装
  - 警告システムとモデレーションログ機能を実装
  - ユーザーキック・BAN機能（ペナルティは書き込み不可のみ）を実装
  - モデレーション設定管理画面を実装
  - モデレーション機能のテストを作成
  - _要件: 3.3_

- [×] 12. 管理者ダッシュボードの実装






  - Web管理ダッシュボードのメイン画面を作成
  - ユーザー管理画面（一覧、ロール編集、BAN/キック）を実装
  - サーバー設定管理画面を実装
  - システム監視・リソース使用量表示機能を実装
  - 管理者ダッシュボードのテストを作成
  - _要件: 3.1, 3.2, 3.4_

- [x] 13. 脚本ビュー・編集機能の実装






  - 脚本データモデル（Script, ScriptLine）とバリデーション機能を実装
  - 脚本管理API（作成・取得・更新・削除）を実装
  - 脚本行管理API（行追加・更新・削除・並び替え）を実装
  - 脚本権限管理機能（ロール・ユーザー単位の閲覧・編集権限）を実装
  - 書式設定機能（太字・下線・斜体・色分け）を実装
  - 同時編集制御機能（競合防止・変更通知）を実装
  - 脚本編集履歴・バージョン管理機能を実装
  - 脚本機能のテストを作成
  - （追加機能）脚本の印刷に最適化
  - （追加機能）場面ごとの分割機能の実装
  - _要件: 14.1, 14.2, 14.3, 14.4, 14.5, 14.6, 14.7, 14.8_

- [x] 14. データ同期とキャッシュ最適化の実装









  - TiDB ↔ SQLiteの双方向データ同期機能を実装
  - メモリキャッシュ管理とガベージコレクション機能を実装
  - オフライン時の同期キュー管理を実装
  - リソース監視と自動最適化機能を実装
  - データ同期機能のテストを作成
  - _要件: 9.1, 9.2, 9.3, 9.4, 13.1, 13.2, 13.3_

- [x] 15. React.js フロントエンド基盤の構築





  - React.js + TypeScript + Tailwind CSS + Viteプロジェクトを初期化
  - レスポンシブデザイン対応のレイアウトコンポーネントを作成
  - API通信サービスとSocket.io統合を実装
  - 認証状態管理（Context API）を実装
  - ルーティング設定とナビゲーション機能を実装
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [x] 16. 認証・プロフィール画面の実装



  - ログインフォームコンポーネント（レスポンシブ対応）を作成
  - ユーザー登録フォーム（登録キー入力付き）を作成
  - プロフィール設定画面（アバター、ステータス、自己紹介）を実装
  - オンラインステータス選択・カスタムステータス設定UIを実装
  - 認証エラーハンドリングとバリデーション表示を実装
  - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 11.1, 11.2, 11.3, 11.4_

- [x] 17. メインチャット画面とチャンネル管理UIの実装



  - チャンネル一覧サイドバー（カテゴリー対応）を作成
  - チャンネル種別別の表示・操作UIを実装
  - メッセージ一覧表示コンポーネント（無限スクロール対応）を作成
  - メッセージ入力フォームとリアルタイム送信を実装
  - チャンネル作成・設定・権限管理UIを実装
  - _要件: 4.1, 4.2, 4.3, 4.4, 6.1, 8.4, 11.1, 11.2, 11.3, 11.4_

- [ ] 18. 脚本ビューUIの実装
  - 脚本一覧・選択画面（権限に応じた表示）を作成
  - 5列構成の脚本テーブル表示コンポーネント（登場人物名・台詞・照明・音響映像・備考）を実装
  - 脚本セル編集機能（インライン編集・リアルタイム保存）を実装
  - 書式設定ツールバー（太字・下線・斜体・色分け）を実装
  - 台詞（黒字）・動き（青字）の自動色分け機能を実装
  - 行追加・削除・並び替え機能を実装
  - 脚本権限設定UI（閲覧・編集権限管理）を実装
  - 同時編集時の競合表示・解決UI を実装
  - 脚本編集履歴表示機能を実装
  - iPad・PC・スマホ対応のレスポンシブ脚本ビューを実装
  - _要件: 14.1, 14.2, 14.3, 14.4, 14.5, 14.6, 14.7, 14.8, 11.1, 11.2, 11.3, 11.4_

- [ ] 19. 高度なメッセージ機能UIの実装
  - Markdown記法対応のメッセージ表示・入力を実装
  - メンション機能（@ユーザー名の自動補完）を実装
  - リアクションピッカーとリアクション表示を実装
  - メッセージ編集・削除UI（権限チェック付き）を実装
  - スレッド表示・返信機能UIを実装
  - _要件: 6.1, 6.2, 6.3, 6.4, 7.2, 8.1, 8.3_

- [ ] 20. ファイル共有とリッチコンテンツUIの実装
  - ファイルアップロードコンポーネント（ドラッグ&ドロップ対応）を作成
  - 画像・動画プレビュー表示機能を実装
  - リンクプレビュー自動表示機能を実装
  - ファイルダウンロード・共有機能を実装
  - アップロード進捗表示とエラーハンドリングを実装
  - _要件: 7.1, 7.2, 7.3, 7.4, 11.1, 11.4_

- [ ] 21. メッセージ検索とピン留め機能UIの実装
  - メッセージ検索画面（キーワード、フィルター機能）を作成
  - 検索結果表示とハイライト機能を実装
  - ピン留めメッセージ表示・管理UIを実装
  - 検索履歴とお気に入り検索機能を実装
  - _要件: 8.2, 8.3_

- [ ] 22. ロール・権限管理UIの実装
  - ロール管理画面（作成・編集・削除・色設定）を作成
  - 権限設定UI（階層的権限表示）を実装
  - ユーザーロール割り当て画面を実装
  - ロール一覧表示（全ユーザー確認可能）を作成
  - 権限チェック結果の可視化機能を実装
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 23. 管理者ダッシュボードUIの実装
  - 管理者ダッシュボードメイン画面を作成
  - ユーザー管理画面（一覧・詳細・操作）を実装
  - モデレーション管理画面（ログ表示・設定）を実装
  - システム監視画面（リソース使用量・統計）を実装
  - サーバー設定画面を実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ] 24. レート制限とセキュリティ機能の実装
  - API レート制限機能（メッセージ、ファイル、認証）を実装
  - 入力サニタイゼーションとXSS対策を実装
  - CSRF対策とセキュリティヘッダー設定を実装
  - 自動モデレーション機能の詳細実装
  - セキュリティ機能のテストを作成
  - _要件: 10.3, 10.4_

- [ ] 25. リソース監視と使用量警告システムの実装
  - TiDB Request Unit使用量監視機能を実装
  - Google Drive容量監視機能を実装
  - Render.com RAM使用量監視機能を実装
  - 使用量上限警告・通知システムを実装
  - リソース最適化の自動実行機能を実装
  - _要件: 9.4, 13.4, 14.2, 14.3, 14.4, 14.5_

- [ ] 26. エラーハンドリングとフォールバック機能の実装
  - グローバルエラーハンドラーとエラー境界を実装
  - TiDB接続障害時のローカルキャッシュ継続動作を実装
  - ネットワーク障害時の自動再接続・同期機能を実装
  - ユーザーフレンドリーなエラーメッセージ表示を実装
  - オフライン時の操作キューイング機能を実装
  - _要件: 9.1, 9.2, 9.3, 13.1, 13.2, 13.3_

- [ ] 27. パフォーマンス最適化とメモリ管理の実装
  - メッセージ一覧の仮想スクロール実装
  - 画像・ファイルの遅延読み込み実装
  - Socket.io接続の最適化とメモリリーク対策
  - ガベージコレクション最適化とメモリ監視
  - 100人同時接続でのパフォーマンステストを実行
  - _要件: 13.1, 13.2, 13.3, 11.1, 11.2_

- [ ] 28. デプロイメント設定とCI/CD構築
  - Render.com用のデプロイ設定（512MB RAM最適化）を作成
  - 環境変数設定とプロダクション最適化を実装
  - TiDB Cloud Serverless接続設定を実装
  - GitHub Actions CI/CDパイプラインを設定
  - デプロイメントテストを実行
  - _要件: 13.1, 13.2, 13.3, 14.1, 14.4_

- [ ] 29. 統合テストとE2Eテスト
  - 主要ユーザーフローのE2Eテスト（iPad、PC、スマホ）を作成
  - API統合テスト（TiDB、SQLite同期）の完全実装
  - リアルタイム通信のテスト実装
  - パフォーマンス・負荷テスト（100人同時接続）の実行
  - セキュリティテストの実行
  - _要件: 全要件の統合テスト_

- [ ] 30. ドキュメント作成と運用準備
  - ユーザー向け操作マニュアル（各機能の使い方）を作成
  - 管理者向け運用ガイド（ダッシュボード操作、モデレーション）を作成
  - TiDB Cloud・Google Services設定手順書を作成
  - トラブルシューティングガイド（よくある問題と解決方法）を作成
  - システム監視・メンテナンス手順書を作成
  - _要件: 3.1, 3.2, 3.4_